"use strict";angular.module("unsavedChanges",["resettable"]).provider("unsavedWarningsConfig",function(){var n=this,t=!1,i=!0,f=["$locationChangeStart","$stateChangeStart"],r="You will lose unsaved changes if you leave this page",u="You will lose unsaved changes if you reload this page";Object.defineProperty(n,"navigateMessage",{get:function(){return r},set:function(n){r=n}});Object.defineProperty(n,"reloadMessage",{get:function(){return u},set:function(n){u=n}});Object.defineProperty(n,"useTranslateService",{get:function(){return i},set:function(n){i=!!n}});Object.defineProperty(n,"routeEvent",{get:function(){return f},set:function(n){typeof n=="string"&&(n=[n]);f=n}});Object.defineProperty(n,"logEnabled",{get:function(){return t},set:function(n){t=!!n}});this.$get=["$injector",function(n){function o(t){return n.has("$translate")&&i?n.get("$translate").instant(t):!1}var e={log:function(){if(console.log&&t&&arguments.length){var n=[].slice.call(arguments);typeof console.log=="object"?log.apply.call(console.log,console,n):console.log.apply(console,n)}}};return Object.defineProperty(e,"useTranslateService",{get:function(){return i}}),Object.defineProperty(e,"reloadMessage",{get:function(){return o(u)||u}}),Object.defineProperty(e,"navigateMessage",{get:function(){return o(r)||r}}),Object.defineProperty(e,"routeEvent",{get:function(){return f}}),Object.defineProperty(e,"logEnabled",{get:function(){return t}}),e}]}).service("unsavedWarningSharedService",["$rootScope","unsavedWarningsConfig","$injector","$window",function(n,t,i,r){function o(){return f=!0,angular.forEach(u,function(n){t.log("Form : "+n.$name+" dirty : "+n.$dirty);n.$dirty&&(f=!1)}),f}function s(){t.log("No more forms, tearing down");angular.forEach(e,function(n){n()});e=[];r.onbeforeunload=null}function c(){t.log("Setting up");r.onbeforeunload=h.confirmExit;var i=t.routeEvent;angular.forEach(i,function(i){var r=n.$on(i,function(r){t.log("user is moving with "+i);o()?t.log("all forms are clean"):(t.log("a form is dirty"),confirm(t.navigateMessage)?(t.log("user doesn't care about loosing stuff"),n.$broadcast("resetResettables")):(t.log("user wants to cancel leaving"),r.preventDefault()))});e.push(r)})}var h=this,u=[],f=!0,e=[];this.allForms=function(){return u};this.init=function(n){u.length===0&&c();t.log("Registering form",n);u.push(n)};this.removeForm=function(n){var i=u.indexOf(n);i!==-1&&(u.splice(i,1),t.log("Removing form from watch list",n),u.length===0&&s())};this.confirmExit=function(){if(!o())return t.reloadMessage;n.$broadcast("resetResettables");s()}}]).directive("unsavedWarningClear",["unsavedWarningSharedService",function(){return{scope:{},require:"^form",priority:10,link:function(n,t,i,r){t.bind("click",function(){r.$setPristine()})}}}]).directive("unsavedWarningForm",["unsavedWarningSharedService","$rootScope",function(n){return{scope:{},require:"^form",link:function(t,i,r,u){for(var f=0;i[0].tagName!=="FORM"&&f<3;)f++,i=i.parent();if(f>=3)throw"unsavedWarningForm must be inside a form element";n.init(u);i.bind("submit",function(){u.$valid&&u.$setPristine()});i.bind("reset",function(n){n.preventDefault();var r=angular.element(i[0].querySelector("[resettable]"));r.length&&t.$apply(r.triggerHandler("resetResettables"));u.$setPristine()});t.$on("$destroy",function(){n.removeForm(u)})}}}]);angular.module("resettable",[]).directive("resettable",["$parse","$compile","$rootScope",function(n){return{restrict:"A",link:function(t,i,r){var e,u,o,f,s;r.$observe("ngModel",function(){u=n(r.ngModel);e=u.assign;o=u(t)});f=function(){e(t,o)};i.on("resetResettables",f);s=t.$on("resetResettables",f);t.$on("$destroy",s)}}}]);
/*
//# sourceMappingURL=unsavedChanges.min.js.map
*/